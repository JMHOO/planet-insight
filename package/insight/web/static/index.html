<!doctype html>
<html lang="en" data-framework="backbonejs">

<head>
    <meta charset="utf-8">
    <title>Planet Insight</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <link href="css/index.css" rel="stylesheet">
</head>

<body>
    <!-- NAV BAR -->
    <div class="flex-column">
        <nav id="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <h3>Planet Insight</h3>
            </div>
            <!-- Sidebar Links -->
            <ul class="list-unstyled components nav " id="navTab">
                <p>Hyper-parameter searching</p>
                <li><a class="active" href="#tab-json">JSON Models</a></li>
                <li><a href="#tab-task">Tasks</a></li>
                <li><a href="#tab-instance">Instances</a></li>
            </ul>
        </nav>

        <div id="content" class="tab-content">
            <div class="tab-pane fade show active" id="tab-json">
                <nav class="navbar navbar-light bg-light justify-content-between">
                    <h1 class="navbar-text">JSON Models</h1>
                    <button class="navbar-text btn btn-outline-success" id="btnNewModel"><i class="fa fa-plus" aria-hidden="true"></i> New</button>
                </nav>
                <div class="col-sm-12">
                    <section id="json_models">
                        <div id="list_json_models">
                        </div>
                    </section>
                </div>
            </div>
            <div class="tab-pane fade" id="tab-task">
                <nav class="navbar navbar-light bg-light justify-content-between">
                    <h1 class="navbar-text">Tasks</h1>
                    <button class="navbar-text btn btn-outline-success" id="btnNewTask"><i class="fa fa-plus" aria-hidden="true"></i> New</button>
                </nav>
                <div class="col-sm-12">
                    <section id="job_instances">
                        <div id="list_job_instances">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th width=6%>#</th>
                                        <th width=20%>Name</th>
                                        <th width=20%>JSON Model</th>
                                        <th width=25%>Dataset</th>
                                        <th width=8% align="center">Epochs</th>
                                        <th width=10%>Status</th>
                                        <th width=12%>Created</th>
                                    </tr>
                                </thead>
                                <tbody id="tasks-table-body">
                                </tbody>
                            </table>
                        </div>
                    </section>
                </div>
            </div>
            <div class="tab-pane fade" id="tab-instance">
                <div class="col-sm-12">
                    <h1>Instances</h1>
                    content of tab 3
                </div>
            </div>
        </div>


    </div>


    <!-- Modal -->
    <div id="add_project" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header login-header">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h4 class="modal-title">Add Project</h4>
                </div>
                <div class="modal-body">
                    <input type="text" placeholder="Project Title" name="name">
                    <input type="text" placeholder="Post of Post" name="mail">
                    <input type="text" placeholder="Author" name="passsword">
                    <textarea placeholder="Desicrption"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="cancel" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>

    <script id="task-template" type="text/template">
        <td>
            <a class="btn btn-danger remove-task" href="javascript:void(0)"><i class="fa fa-trash" aria-hidden="true"></i></a>
        </td>
        <td>
            <a class="viewtask badge badge-info" href="javascript:void(0)">
                <%= instance_name %>
            </a>
        </td>
        <td>
            <%= model_name %>
        </td>
        <td>
            <%= dataset_name %>
        </td>
        <td>
            <%= epochs %>
        </td>
        <td>
            <%= job_status %>
        </td>
        <td>
            <%= created %>
        </td>
    </script>

    <!-- Add JSON Modal -->
    <div id="add-json-model" class="modal fade" rold="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Add new model</h4>
                    <button type="button" class="close" data-dismiss="modal">×</button>
                </div>

                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="model-name" class="form-control-label">Model Name:</label>
                            <input type="text" class="form-control" id="model-name"></input>
                        </div>
                        <div class="form-group">
                            <label for="model-json" class="form-control-label">JSON:</label>
                            <textarea class="form-control" id="model-json"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="addNewModel">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="add-task-model" class="modal fade" rold="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Add new task</h4>
                    <button type="button" class="close" data-dismiss="modal">×</button>
                </div>

                <div class="modal-body">
                    <form>
                        <div class="form-row">
                            <div class="form-group col-md-8">
                                <label for="instance-name" class="form-control-label">Task Name</label>
                                <input type="text" class="form-control" id="instance-name"></input>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="maximum-epoch" class="form-control-label">Maximum Epoch</label>
                                <input type="text" class="form-control" id="maximum-epoch"></input>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="task-model" class="form-control-label">JSON model</label>
                                <select class="form-control" id="selectJsonModel">Choose model</select>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="task-dataset" class="form-control-label">Dataset</label>
                                <select class="form-control" id="selectDataset">Choose weights</select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="selectWeights" class="col-form-label">Weights</label>
                                <select class="form-control" id="selectWeights">Choose weights</select>
                            </div>

                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="addNewTask">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Task Modal -->
    <div id="view-task-dialog" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header login-header">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h4 class="modal-title">Task Detail</h4>
                </div>
                <div class="modal-body">
                    <ul id="task-body">
                    </ul>
                    <hr>
                    <h5>Logs</h5>
                    <div id="task-logs">
                        <ul class="list-group">
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="cancel" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>

    <script src="js/lib/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="js/lib/underscore-min.js"></script>
    <script src="js/lib/backbone-min.js"></script>
    <script src="js/lib/renderjson.js"></script>
    <script src="js/models/json_model.js"></script>
    <script src="js/models/task.js"></script>
    <script src="js/models/log.js"></script>
    <script src="js/collections/JSONCollection.js"></script>
    <script src="js/collections/TaskCollection.js"></script>
    <script src="js/collections/TaskLogs.js"></script>
    <script src="js/views/JSONModelListView.js"></script>
    <script src="js/views/JSONModelView.js"></script>
    <script src="js/views/task-view.js"></script>
    <script src="js/views/TaskListView.js"></script>
    <script src="js/views/app-view.js"></script>
    <script src="js/app.js"></script>

    <!-- Menu Toggle Script -->
    <script>
        $(document).ready(function() {
            $("#navTab a").click(function(e) {
                $(this).tab('show');
            });

            $("#btnNewModel").click(function() {
                $('#add-json-model').modal();
            });

            $("#btnNewTask").click(function() {
                // load dataset list
                $('#selectDataset').html('');
                $.ajax({
                        url: '/insight/api/v1.0/dataset-paired',
                        type: 'GET',
                        dataType: 'json',
                    })
                    .done(function(data) {
                        var output = '';
                        $.each(data, function(index, el) {
                            output += '<option value="' + el.name + '">' + el.name + '</option>';
                        });
                        $('#selectDataset').append(output)
                    });
                // load json model list
                $('#selectJsonModel').html('');
                $.ajax({
                        url: '/insight/api/v1.0/models',
                        type: 'GET',
                        dataType: 'json',
                    })
                    .done(function(data) {
                        var output = '';
                        $.each(data, function(index, el) {
                            output += '<option value="' + el.model_name + '">' + el.model_name + '</option>';
                        });
                        $('#selectJsonModel').append(output)
                    });
                // load weights list
                $('#selectWeights').html('');
                $('#selectWeights').append('<option value="NONE">NONE</option>');
                $.ajax({
                        url: '/insight/api/v1.0/weights',
                        type: 'GET',
                        dataType: 'json',
                    })
                    .done(function(data) {
                        var output = '';
                        $.each(data, function(index, el) {
                            output += '<option value="' + el.name + '">' + el.name + '</option>';
                        });
                        $('#selectWeights').append(output)
                    });
                $('#add-task-model').modal();
            });

            $("#addNewModel").click(function(e) {
                e.preventDefault();
                var formData = {};
                formData['name'] = $('#model-name').val();
                formData['defination'] = $('#model-json').val();

                ajax_new_model(formData);
            });

            $('#addNewTask').click(function(e) {
                e.preventDefault();
                var formData = {};
                formData['instance_name'] = $('#instance-name').val();
                formData['model_name'] = $('#selectJsonModel').val();
                formData['dataset_name'] = $('#selectDataset').val();
                formData['pretrain'] = $('#selectWeights').val();
                formData['epochs'] = $('#maximum-epoch').val();

                ajax_new_task(formData);
            });
        });

        function ajax_new_model(options) {
            $.ajax({
                type: "POST",
                url: "/insight/api/v1.0/models",
                data: JSON.stringify(options),
                contentType: "application/json;",
                dataType: "json",
                success: function(data, status, jqXHR) {
                    app.jsonlist.collection.add(data);
                },
                error: function(jqXHR, status) {
                    console.log(jqXHR);
                }
            });
        };

        function ajax_new_task(options) {
            $.ajax({
                type: "POST",
                url: "/insight/api/v1.0/jobs",
                data: JSON.stringify(options),
                contentType: "application/json;",
                dataType: "json",
                success: function(data, status, jqXHR) {
                    app.tasklist.collection.add(data);
                },
                error: function(jqXHR, status) {
                    console.log(jqXHR);
                }
            });
        };
    </script>
</body>

</html>